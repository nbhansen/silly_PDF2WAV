@startuml PDF_to_Audio_Clean_Architecture
!theme plain
skinparam componentStyle rectangle
skinparam backgroundColor #FFFFFF
skinparam component {
  BackgroundColor #E1F5FE
  BorderColor #0277BD
}
skinparam interface {
  BackgroundColor #F3E5F5
  BorderColor #7B1FA2
}
skinparam note {
  BackgroundColor #FFFDE7
  BorderColor #F57F17
}

title PDF to Audio Application - Clean Architecture Overview\n(Post-YOLO Consolidation)

package "ğŸŒ Web Layer" {
  component [Flask Routes] as routes
  component [Templates] as templates
  component [Static Assets] as static
}

package "ğŸ­ Domain Factories" {
  component [Service Factory] as factory
  note right of factory : Simple factory functions\nreplacing 195-line CompositionRoot
}

package "ğŸ“¦ Domain Aggregates" {
  
  package "ğŸ“„ Document Aggregate" {
    interface IDocumentEngine
    component [DocumentEngine] as docEngine
    note right of docEngine : Unified PDF processing\nReplaces PDFProcessingService
  }
  
  package "ğŸ”Š Audio Aggregate" {
    interface IAudioEngine
    component [AudioEngine] as audioEngine
    interface ITimingEngine  
    component [TimingEngine] as timingEngine
    note right of audioEngine : Consolidated audio operations\nReplaces 4 separate services
    note right of timingEngine : Unified timing strategies\nReplaces 3 timing implementations
  }
  
  package "ğŸ“ Text Aggregate" {
    interface ITextPipeline
    component [TextPipeline] as textPipeline
    note right of textPipeline : Unified text processing\nReplaces TextCleaningService\n& AcademicSSMLService
  }
  
  package "ğŸ—‚ï¸ Container Aggregate" {
    interface IServiceContainer
    component [ServiceContainer] as container
    note right of container : Simple dependency injection\nwith lazy loading
  }
}

package "ğŸ”§ Infrastructure Layer" {
  
  package "ğŸ—£ï¸ TTS Providers" {
    component [PiperTTSProvider] as piper
    component [GeminiTTSProvider] as gemini
    interface ITTSEngine as iTTS
  }
  
  package "ğŸ§  LLM Providers" {
    component [GeminiLLMProvider] as llm
    interface ILLMProvider as iLLM
  }
  
  package "ğŸ‘ï¸ OCR Providers" {
    component [TesseractOCRProvider] as ocr
    interface IOCRProvider as iOCR
  }
  
  package "ğŸ“ File Management" {
    component [FileManager] as fileManager
    component [FileCleanupScheduler] as cleanup
    interface IFileManager as iFile
  }
}

package "ğŸ¯ Domain Core" {
  component [Domain Models] as models
  component [Domain Interfaces] as interfaces
  component [Error Handling] as errors
  component [System Config] as config
}

' Web Layer connections
routes --> factory : creates services
routes --> templates : renders
routes --> static : serves assets

' Factory connections
factory --> docEngine : creates
factory --> audioEngine : creates
factory --> textPipeline : creates
factory --> container : creates

' Domain Aggregate internal connections
docEngine ..|> IDocumentEngine
audioEngine ..|> IAudioEngine
timingEngine ..|> ITimingEngine
textPipeline ..|> ITextPipeline
container ..|> IServiceContainer

' Cross-aggregate dependencies
audioEngine --> timingEngine : delegates timing
docEngine --> audioEngine : generates audio
docEngine --> textPipeline : processes text

' Infrastructure connections
piper ..|> iTTS
gemini ..|> iTTS
llm ..|> iLLM
ocr ..|> iOCR
fileManager ..|> iFile

' Service to Infrastructure connections
audioEngine --> iTTS : uses
audioEngine --> iFile : uses
timingEngine --> iTTS : uses
timingEngine --> iFile : uses
textPipeline --> iLLM : uses (optional)
docEngine --> iOCR : uses
docEngine --> iFile : uses

' Domain Core connections
audioEngine --> models : uses
audioEngine --> errors : uses
timingEngine --> models : uses
textPipeline --> models : uses
docEngine --> models : uses
factory --> config : reads

' Container manages all services
container --> audioEngine : provides
container --> textPipeline : provides  
container --> docEngine : provides
container --> fileManager : provides

note as N1
ğŸ¯ **Architecture Achievements**
â€¢ High Cohesion: Related functionality grouped in aggregates
â€¢ Low Coupling: Clean interfaces and dependency injection
â€¢ SOLID Principles: Each aggregate has single responsibility
â€¢ Clean Dependencies: Domain â†’ Infrastructure (not reversed)
â€¢ Simplified Structure: 4 aggregates vs 12+ scattered services
end note

note as N2
ğŸ—‘ï¸ **YOLO Deletions Completed**
â€¢ Removed 13 scattered service files (~1,500+ lines)
â€¢ Deleted 3 test files for legacy services
â€¢ Eliminated 2 service directories entirely
â€¢ Replaced complex CompositionRoot with simple factories
â€¢ Maintained 100% test compatibility (27/27 passing)
end note

@enduml